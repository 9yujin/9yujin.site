import { Img } from "components";

# \[Nginx] ì„œë¸Œ ë„ë©”ì¸ ì„¤ì •, HTTPS ì ìš©

_2021.12.28_

'dev.9yujin.shop' ê·¸ë¦¬ê³  'prod.9yujin.shop' ì´ë ‡ê²Œ ë‘ ê°œì˜ ì„œë¸Œ ë„ë©”ì¸ì„ ë§Œë“¤ì–´ë³´ì.

## 1\. ê°€ë¹„ì•„ DNS ë ˆì½”ë“œ ìˆ˜ì •

ê°€ë¹„ì•„ì—ì„œ ë¨¼ì € CNAMEìœ¼ë¡œ ì„œë²„ ë„ë©”ì¸ì„ ë“±ë¡í•´ì¤€ë‹¤. devì™€ prod ë‘ê°œë¥¼ ìƒì„±í•œë‹¤.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FD4vpM%2Fbtro7Ds1QPV%2FPP3AjsJ3Fk09Aykq2ABGzK%2Fimg.jpg)

## 2\. ì„œë¸Œë„ë©”ì¸ í˜ì´ì§€ ì •ì  íŒŒì¼ ìƒì„±

**1) ì„œë¸Œë„ë©”ì¸ìœ¼ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ë³´ì—¬ì¤„ íŒŒì¼ë“¤ì„ ë„£ì–´ë‘˜ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“ ë‹¤.**

ê¸°ì¡´ `/var/www/html` ì— ì¶”ê°€ë¡œ `/var/www/dev` ê³¼ `/var/www/prod` ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.

**2) /var/www/devì— html íŒŒì¼ì„ ì„ì‹œë¡œ ì‘ì„±í•´ì¤€ë‹¤.**

```html
<html>
  <head>
    <title>dev-test</title>
  </head>
  <body>
    <h1>hello dev-subdomain</h1>
  </body>
  <html></html>
</html>
```

## 3\. Nginx ì„¤ì • 1

**1\)** `/etc/nginx/sites-available` **ë””ë ‰í† ë¦¬ì— ì„œë¸Œë„ë©”ì¸ì„ ìœ„í•œ ì„¤ì • íŒŒì¼ì„ ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤.**

```nginx
server {
        listen 80;
        listen [::]:80;

        root /var/www/dev;
        index index.html index.htm index.nginx-debian.html;

        server_name dev.9yujin.shop;

        location / {
                try_files $uri $uri/ =404;
        }
        return 301 https://dev.9yujin.shop$request_uri;
}
```

ì¼ë‹¨ì€ ì´ë ‡ê²Œë§Œ ì‘ì„±í–ˆë‹¤. `root`ë¥¼ devì˜ ì •ì íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì§€ì •í•´ì£¼ì—ˆë‹¤.

**2)** `/sites-enabled` **ë¡œ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì—°ê²°í•œë‹¤.**

```bash
ln -s etc/nginx/sites-available/dev etc/nginx/sites-enabled
```

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbZdowt%2FbtrpaHvaCsi%2FM2Lk6E4mQGeI5zuHDchSNK%2Fimg.png)

## 4\. ì¸ì¦ì„œ ë°œê¸‰

**1\) ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ nginx ì„¤ì •ì€ ì œì™¸í•˜ê³  ì¸ì¦ì„œë§Œ ë”°ë¡œ ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆë‹¤.**

```bash
sudo certbot certonly -d [xxx.example.com] -d [yyy.example.com]
```

**2\) ì•„ë˜ì™€ ê°™ì€ ì§ˆë¬¸ì´ ë‚˜ì˜¨ë‹¤. 2ë²ˆì„ ê³ ë¥¸ë‹¤.** (ì›¹ì„œë²„ ì„¤ì •ì´ ì§„í–‰ë˜ì§€ ì•Šê³  ì¸ì¦ì„œë§Œ ë°œê¸‰ë°›ëŠ” ì˜µì…˜ì¸ë“¯)

```
How would you like to authenticate with the ACME CA?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: Nginx Web Server plugin (nginx)
2: Spin up a temporary webserver (standalone)
3: Place files in webroot directory (webroot)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-3] then [enter] (press 'c' to cancel): 2
```

**3\) ì¸ì¦ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œê¸‰ì´ ë˜ê³ , pem í‚¤ì˜ ê²½ë¡œë¥¼ ì•Œë ¤ì¤€ë‹¤.**

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FyVRNB%2FbtrpaHWeimz%2FtVXN30PbW8BU6jqNLOiJnk%2Fimg.png) \*ìœ„ì—ì„œ certbot --nginx ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°œê¸‰ë°›ì•˜ì„ ë•Œì™€ ë˜‘ê°™ì€ ê²½ë¡œì— ì €ì¥ì´ ëœë‹¤.

-

> \`-d\`ì˜µì…˜ìœ¼ë¡œ í•œë²ˆì— ì—¬ëŸ¬ ë„ë©”ì¸ì˜ ì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ì„ ìˆ˜ ìˆì„ ì¤„ ì•Œì•˜ì§€ë§Œ, ì‹¤ì œë¡œ í•´ë³´ë‹ˆ ë§ˆì§€ë§‰ì— ì…ë ¥í•œ ë„ë©”ì¸ì—ê²Œë§Œ ë°œê¸‰ì´ ë˜ì—ˆë‹¤.

> \`\*.9yujin.shop\` ì„ ì…ë ¥í•˜ë©´ ëª¨ë“  ì„œë¸Œë„ë©”ì¸ì— ì ìš©ë  ì¤„ ì•Œì•˜ì§€ë§Œ, ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

## 5\. Nginx ì„¤ì • 2

ì²˜ìŒì— ë©”ì¸ ë„ë©”ì¸ì— https ì ìš©í–ˆë˜ ê²ƒê³¼ ë™ì¼í•˜ë‹¤.

**1\)** `/sites-available/dev` **ì— ë‹¤ìŒì„ ì¶”ê°€í•´ì¤€ë‹¤.**

```nginx
server {
   listen 443 ssl; # managed by Certbot
     root /var/www/dev;
   server_name dev.9yujin.shop;

   ssl_certificate /etc/letsencrypt/live/dev.9yujin.shop/fullchain.pem; # managed by Certbot
   ssl_certificate_key /etc/letsencrypt/live/dev.9yujin.shop/privkey.pem; # managed by Certbot
   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
     ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}
```

ì„œë²„ë¸”ë¡ì„ í•˜ë‚˜ ë” ë§Œë“¤ì–´ì„œ 443ë²ˆ í¬íŠ¸ë¥¼ ì—´ì–´ë‘ê³ , ë°œê¸‰ë°›ì€ pem keyì˜ ê²½ë¡œë¥¼ ë„£ì–´ì¤€ë‹¤.  
\(14ë²ˆ ê³¼ì •ì—ì„œ `certbot --nginx` ëª…ë ¹ì–´ê°€ ìë™ìœ¼ë¡œ í•´ì¤€ ì‘ì—…)

**2\) 80ë²ˆ í¬íŠ¸ë¡œ ë“¤ì–´ì™”ì„ ë•Œ : httpsë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì¼œì¤€ë‹¤.**

```nginx
server {
    listen 80;
    listen [::]:80;
    root /var/www/prod;
    index index.html index.htm index.nginx-debian.html;

    server_name prod.9yujin.shop;

    location / {
            try_files $uri $uri/ =404;
    }
    return 301 https://prod.9yujin.shop$request_uri;
}
```

![](https://blog.kakaocdn.net/dn/dbnF9u/btroVrHMmSB/GGftiZoQX2j0RLKRiJTm30/img.gif)

---

> ğŸš¨ \[210108\]  
> ì¸ì¦ì„œë¥¼ ë°›ê³  confíŒŒì¼ì„ ìˆ˜ì •í• ë•Œ ìœ„ì²˜ëŸ¼ ì•ˆí•´ë„ ë˜ê³ ..
> certbotì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ì„œë²„ë¸”ë¡ ë‘ê°œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ë„ ëœë‹¤. ìœ„ì— ê¸°ë³¸ìœ¼ë¡œ ìˆë˜ ê²ƒ(defaultì— ìˆëŠ”) ë‹¤ ì§€ì›Œë„ ë¬´ë°©.

---

[ì°¸ê³ 1](https://dev.to/knowbee/how-to-setup-secure-subdomains-using-nginx-and-certbot-on-a-vps-4m8h) [ì°¸ê³ 2](https://hello-gg.tistory.com/47?category=909033)
