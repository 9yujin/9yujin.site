import { Img } from "components";

# [React] ë‹¤ì‹œ ë§Œë“œëŠ” React-Messenger (selectorFamily, FaCC)

_2022.11.04_

ì„¸ì˜¤ìŠ¤ ë¦¬ì•¡íŠ¸ ë©”ì‹ ì € ê³¼ì œë¥¼ ì¤€ë¹„í•˜ë©´ì„œ 6ê°œì›” ì „ì— ì œì¶œí–ˆë˜ ê³¼ì œë¥¼ ë‹¤ì‹œ ë³´ì•˜ë‹¤. ì‹œê°„ì— ì«“ê²¨ê°€ë©´ì„œ í•˜ë‹¤ë³´ë‹ˆ, êµ‰ì¥íˆ ë”ëŸ¬ìš´ ë¶€ë¶„ì´ ê½¤ ìˆë‹¤. ì´ëŸ°ì €ëŸ° ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ì„œ ì´ëŸ°ì €ëŸ° ì˜µì…˜ê³¼ propsê°€ ë“¤ì–´ê°€ê²Œ ë˜ê³ , ê·¸ë ‡ê²Œ ëª¬ìŠ¤í„° ì»´í¬ë„ŒíŠ¸ê°€ ë˜ì–´ê°„ë‹¤. ìŠ¤íƒ€ì¼ë§ì„ í• ë•Œë„ ì›í•˜ëŠ” ëŒ€ë¡œ ë ë•Œê¹Œì§€ ìˆ˜ì •ì— ìˆ˜ì •ì„ ê±°ë“­í•˜ë‹¤ë³´ë‹ˆ ë§¤ìš° ë³µì¡í•´ì¡Œë‹¤. ê·¸ë˜ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì€ 6ê°œì›” ì „ ê³¼ì œë¬¼ ë¦¬íŒ©í† ë§ì˜ ê¸°ë¡!

- Recoil selectorFamily
- ì»¤ìŠ¤í…€í›…ì„ ì´ìš©í•´ ë¡œì§ ì¶”ìƒí™”
- Funtion as Child Component
- íƒ€ì… ê°€ë“œ

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F7w1CO%2FbtrQmRLsfUV%2Ff5uy4IFktvem7MmYar7vck%2Fimg.png)
_ì¸ì œ ìƒê°í•´ë³´ë‹ˆ,_

## 1\. ë„¤ì´ë°

ì œì¼ ì‹œê¸‰í–ˆë‹¤. ê³„ì† ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ì„œ ê¸‰ê¸‰í•˜ê²Œ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ê°”ë‹¤. Room, chats, chatList ë“±ì˜ ì´ë¦„ì´ ë³„ë‹¤ë¥¸ ê¸°ì¤€ ì—†ì´ ì‚¬ìš©ë˜ëŠ”ê²Œ ìŠ¤ìŠ¤ë¡œë„ ê°ë‹¹í•˜ê¸° í˜ë“¤ ì •ë„ì˜€ë‹¤. ê°œì¸í”„ë¡œì íŠ¸ì„ì—ë„ ë„¤ì´ë°ì€ ê½¤ ì¤‘ìš”í•˜ë‹¤..!

<Img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fc6n5HZ%2FbtrQlq10Ap5%2FQKKVEOlkMvek5cBRRzIAsK%2Fimg.png" />
*ğŸ’©*

ìœ„ ì‚¬ì§„ì´ ë°”ë¡œ ê·¸ ë‹¨ì ì¸ ì˜ˆë‹¤. atomì˜ ì´ë¦„ì€ 'chatState'ì¸ë° keyëŠ” 'chats'. ì‹¬ì§€ì–´ íƒ€ì…ì€ 'RoomType'ì˜ ë°°ì—´ì´ë‹¤. ë­ ì´ëŸ° ì“°ë ˆê¸°ê°™ì€ ì½”ë“œê°€ ìˆì„ ìˆ˜ê°€. ìµœëŒ€í•œ ëª…í™•íˆ ê¸°ì¤€ì„ ì¡ê³  íƒ€ì…ê³¼ ìƒíƒœë“¤ì˜ ì´ë¦„ë¶€í„° ì§€ì—ˆë‹¤.

```ts
export interface IChat {
  userId: number;
  content: string;
  date: string;
  like: boolean;
  chatId: string;
}
export interface IChatting {
  chattingId: number;
  userIdList: number[];
  chatList: IChat[];
}

export interface IUser {
  userId: number;
  userName: string;
  profileImage: string;
  statusMessage: string;
}
```

ì±— í•˜ë‚˜í•˜ë‚˜ëŠ” `IChat`, ì±„íŒ…ë°© ê´€ë ¨ íƒ€ì…ì€ `IChatting`.

Chattingì˜ chatListì—ëŠ” `IChat`í˜•íƒœì˜ ë°°ì—´ì´ ë“¤ì–´ê°„ë‹¤.

```ts
import chattingsData from "../mocks/chattingsData.json";
import userData from "../mocks/userData.json";
import friendsData from "../mocks/friendsData.json";

export const chattingsState = atom<IChatting[]>({
  key: "chattings",
  default: chattingsData.chattings,
});

export const userState = atom<IUser>({
  key: "user",
  default: userData.users[0],
});

export const friendsState = atom<IUser[]>({
  key: "friends",
  default: friendsData.users,
});
```

ê¸°ë³¸ atomì—ëŠ” `key + State` í˜•ì‹ìœ¼ë¡œ ì´ë¦„ì„ ë¶™ì¸ë‹¤. ë‚´ ì •ë³´(user)ì™€ ì¹œêµ¬ì •ë³´(friends)ë¥¼ ë¶„ë¦¬í•´ì£¼ì—ˆë‹¤.

ì±„íŒ…ëª©ë¡ì€ Chattings, ê° ì±„íŒ…ë°©ë“¤ì€ Roomì´ë¼ëŠ” ë„¤ì´ë°. Chattingsë¥¼ `map`ìœ¼ë¡œ ëŒë ¤ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•´ì£¼ëŠ”ë°, mapì˜ ì²«ë²ˆì§¸ ì¸ìë¡œ chattingì´ë¼ëŠ” ì´ë¦„ì„ ì‚¬ìš©í•´ì£¼ì—ˆë‹¤. Roomê³¼ chatting ë‘ ì´ë¦„ì„ ëª¨ë‘ ì“°ëŠ” ê²ƒì— ëŒ€í•´ì„œ ê³ ë¯¼ì„ ê½¤ í–ˆì—ˆë‹¤. Roomì€ ì»´í¬ë„ŒíŠ¸ ì´ë¦„, chattingì€ ìƒíƒœì˜ ì´ë¦„ìœ¼ë¡œ ìƒê°í•˜ê³  ì§€ê¸ˆê³¼ ê°™ì´ ì‘ì„±í–ˆë‹¤.

## 2\. ë¦¬ì½”ì¼ í™œìš©í•˜ê¸° (selectorFamily)

ë¨¼ì €, ë¬¸ì„œì—ì„œëŠ” `Selector`ë¥¼ ì´ë ‡ê²Œ ì„¤ëª…í•œë‹¤.

> SelectorëŠ” íŒŒìƒëœ ìƒíƒœ(derived state)ì˜ ì¼ë¶€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. íŒŒìƒëœ ìƒíƒœë¥¼ ì–´ë–¤ ë°©ë²•ìœ¼ë¡œë“  ì£¼ì–´ì§„ ìƒíƒœë¥¼ ìˆ˜ì •í•˜ëŠ” ìˆœìˆ˜ í•¨ìˆ˜ì— ì „ë‹¬ëœ ìƒíƒœì˜ ê²°ê³¼ë¬¼ë¡œ ìƒê°í•  ìˆ˜ ìˆë‹¤.

ë¼ê³  í•˜ëŠ”ë°.. í¬ê²Œ ì™€ë‹¿ì§€ëŠ” ì•Šë‹¤. íŒŒìƒëœ ìƒíƒœë¥¼ ê°€ì ¸ì˜¨ë‹¤(get)ëŠ”ê±´, atomì„ ê³§ëŒ€ë¡œ ê°€ì ¸ì˜¤ëŠ”ê²Œ ì•„ë‹ˆë¼ ì›í•˜ëŠ”ëŒ€ë¡œ ê°€ê³µí•´ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒ - ì´ë¼ê³  ì´í•´í–ˆë‹¤. SQLì—ì„œ `SELECT`ë¬¸ì„ ì´ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì›í•˜ëŠ” ê°’ì„ ì¶”ì¶œí•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤. ê·¸ë¿ë§Œ ì•„ë‹ˆë¼ SQLì˜ aggregateí•¨ìˆ˜ì²˜ëŸ¼ ê³„ì‚°ëœ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

`SelectorFamily`ëŠ” `Selector`ì™€ ë¹„ìŠ·í•œ íŒ¨í„´ì´ì§€ë§Œ, `get`ê³¼ `set`ì˜ ì½œë°±ì— ì¸ìë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

```ts filename="atoms/user.ts"
export const userStateByUserId = selectorFamily<IUser, number>({
  key: "userByUserId",
  get:
    (userId: number) =>
    ({ get }) => {
      const user = get(userState);
      const friends = get(friendsState);
      if (userId === 0) {
        return user;
      } else {
        return friends.filter((friend) => friend.userId === userId)[0];
      }
    },
});

export const usersStateByUserIdList = selectorFamily<IUser[], number[]>({
  key: "usersByUserIdList",
  get:
    (userIdList: number[]) =>
    ({ get }) => {
      return userIdList.map((userId) => get(userStateByUserId(userId)));
    },
});
```

ê°„ë‹¨í•˜ê²Œ ì´ëŸ°ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. userIdë¥¼ ì¸ìë¡œ ë°›ì•„ í•´ë‹¹ ìœ ì €ì˜ ì •ë³´ë§Œ ê°€ì ¸ì˜¤ëŠ” selectorì™€ (ê·¸ selectorë¥¼ ì‚¬ìš©í•˜ëŠ”) userIdì˜ ë°°ì—´ì„ ì¸ìë¡œ ë°›ì•„ ìœ ì €ë“¤ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” selectorì´ë‹¤.

get ë‚´ì—ì„œ ë‹¤ë¥¸ atomì˜ ìƒíƒœë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. ë‚´ ì •ë³´ì™€ ì¹œêµ¬ ì •ë³´ê°€ ë‹¤ë¥¸ atomìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ë°,í•˜ë‚˜ì˜ selectorì—ì„œ ëª¨ë‘ ë¶ˆëŸ¬ì™€ ë¦¬í„´í•˜ë„ë¡ í–ˆë‹¤.

#### 2.1 selectorì—ì„œ set ì‚¬ìš©í•˜ê¸°

```ts
export const chattingStateByChattingId = selectorFamily<IChatting, number>({
  key: "chattingByChattingId",
  get:
    (chattingId: number) =>
    ({ get }) =>
      get(chattingsState).filter(
        (chatting) => chatting.chattingId === chattingId
      )[0],
  set:
    (chattingId: number) =>
    ({ set }, newChatting) => {
      set(chattingsState, (prev) =>
        prev.map((chatting) =>
          chatting.chattingId === chattingId
            ? (newChatting as IChatting)
            : chatting
        )
      );
    },
});
```

`get`ë§Œ ìˆì„ ë• readonlyí•œ í•¨ìˆ˜ë§Œ ì œê³µí•˜ì§€ë§Œ `set`ì„ í™œìš©í•œë‹¤ë©´ selectorì—ì„œ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ë„ ì“¸ ìˆ˜ ìˆë‹¤. ê·¸ëƒ¥ `useRecoilState`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì²˜ëŸ¼. ì±—ì„ ë³´ë‚´ëŠ” ê¸°ëŠ¥ë„ `selectorFamily` ì•ˆì—ì„œ êµ¬í˜„í•´ë³´ì•˜ë‹¤. í•´ë‹¹í•˜ëŠ” ì±„íŒ…ë°©ì˜ idì™€ newChattingì„ ì¸ìë¡œ ë³´ë‚¸ë‹¤. ì–´ë–¤ ì‹ìœ¼ë¡œ ë³´ë‚´ì•¼ í•˜ì§€??

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbz0P4U%2FbtrQlIIemZY%2F6fjtRyXe7YJ3Twm9AhRIUk%2Fimg.png)
*https://recoiljs.org/docs/api-reference/utils/selectorFamily/*

set ì†ì„±ì—ëŠ” ìœ„ì˜ íƒ€ì…ì˜ í•¨ìˆ˜ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤. ì •ë¦¬í•˜ë©´ `P => ({set}, newValue) => void;` ì˜ í˜•íƒœì´ë‹¤. ì„¸í„°ì™€ ìƒˆë¡œìš´ ê°’ì„ ì¸ìë¡œ ë³´ë‚¸ë‹¤. ìœ„ì— ì¤‘ì²©ëœ í•¨ìˆ˜ì˜ ì¸ìëŠ” `selectorFamily`ì˜ ì¸ìì´ë‹¤.

```ts filename="useChat.ts"
const useChat = (chattingId: number) => {
  const currentId = useRecoilValue(currentState);
  const [chatting, setChatting] = useRecoilState(
    chattingStateByChattingId(chattingId)
  );

  const sendChat = (value: string) => {
    if (value.length !== 0 && value.replace(/ /g, "").length !== 0) {
      const newChat: IChat = {
        userId: currentId,
        content: value,
        date: dayjs().format(),
        like: false,
        chatId: uuid(),
      };

      setChatting({ ...chatting, chatList: [...chatting.chatList, newChat] });
    }
  };

  return { sendChat };
};

export default useChat;
```

ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì´ë ‡ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

`useRecoilState(chattingStateByChattingId(chattingId));`

## 3\. ì»¤ìŠ¤í…€í›…ìœ¼ë¡œ ë¡œì§ ë¶„ë¦¬

ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ UI ë Œë”ë§ì„ ë‹´ë‹¹í•˜ëŠ” ë¶€ë¶„ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìµœëŒ€í•œ ë¶„ë¦¬í•˜ëŠ”ë°ì— ê´€ì‹¬ì´ ìˆë‹¤. ì´ëŸ¬í•œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ë‹¤ë£¨ëŠ” ì•„í‹°í´ë“¤ì´ ê½¤ ë§ì•˜ë‹¤. ì¡°ê¸ˆ ë” ì„ ì–¸ì ì¸ ì½”ë“œë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ê°€ ì–´ë–¤ ì¼ì„ í•˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ì•Œ ìˆ˜ ìˆê³ , ë³€ê²½ì´ ì¦ì€ UI ì»´í¬ë„ŒíŠ¸ì™€ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë¡œì§ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì„œ ë³€ê²½ì— ìš©ì´í•œ ì¢‹ì€ ì½”ë“œê°€ ë  ìˆ˜ ìˆë‹¤. ëŒ€ì²´ë¡œ ì´ëŸ° ì´ì•¼ê¸°ë¥¼ ì ì–´ë†“ì•˜ë‹¤.

ë°”ë¡œ ìœ„ì—ì„œ ì‘ì„±í–ˆë˜ useChatì´ ê·¸ ë¶„ë¦¬ëœ ë¡œì§ì´ë‹¤.

```tsx filename="roomFooter.tsx"
const RoomFooter = ({ chattingId }: { chattingId: number }) => {
  const inputRef = useRef<HTMLTextAreaElement>(null);
  const { value, onChange, resetValue } = useInput("");
  const { sendChat } = useChat(chattingId);

  const focusInput = () => inputRef.current?.focus();

  useEffect(() => {
    focusInput();
  }, []);

  const handleSendChat = () => {
    sendChat(value);
    resetValue();
    focusInput();
  };

  const onEnter = (e: KeyboardEvent<HTMLTextAreaElement>) => {
    if (e.key === "Enter" && !e.shiftKey) {
      if (e.nativeEvent.isComposing === false) {
        e.preventDefault();
        handleSendChat();
      }
    }
  };

  return (
    <Wrapper>
      <div>
        <MessageInput
          value={value}
          onChange={onChange}
          ref={inputRef}
          onKeyDown={onEnter}
        />
        <SendButton
          onClick={handleSendChat}
          disabled={value.length === 0 ? true : false}
        >
          ì „ì†¡
        </SendButton>
      </div>
    </Wrapper>
  );
};

export default RoomFooter;
```

ì•„ì§ ì¢‹ì€ ì½”ë“œë¼ê³  ë§í•˜ê¸´ ë­í•˜ì§€ë§Œ, UIë¥¼ ë‹¤ë£¨ëŠ” ë¡œì§ë§Œ ë‚¨ì•„ìˆê³  ìƒíƒœë¥¼ ë‹¤ë£¨ëŠ” ë¡œì§ì€ ì „ë¶€ ì»¤ìŠ¤í…€í›…ìœ¼ë¡œ ì¶”ìƒí™”ë˜ì–´ ìˆë„ë¡ í–ˆë‹¤.  
ì´ì™¸ì—ë„ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ë‹¤ë£¨ëŠ” ë¡œì§ ë“±ì„ ì»¤ìŠ¤í…€í›…ìœ¼ë¡œ ë¹¼ë²„ë¦¬ë©´ì„œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë” ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

#### 3.1 ë¦¬ë Œë”ë§ ë¬¸ì œ?

ì›ë˜ëŠ” ì»¤ìŠ¤í…€í›…ì„ ì´ìš©í•´ ê° í•˜ë‚˜ì˜ atomì„ ì œì–´í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ ëª¨ì•„ë†“ê³  ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í–ˆì—ˆë‹¤. ê·¸ ì»´í¬ë„ŒíŠ¸ì—ì„  ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í›…ì—ì„œ êµ¬ë…í•˜ê³ ìˆëŠ” ë‹¤ë¥¸ ìƒíƒœê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ ë¶ˆí•„ìš”í•œ ìƒí™©ì—ì„œë„ ë¦¬ë Œë”ë§ë˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤.

ì˜ˆë¥¼ë“¤ì–´ chatting atomì— ìˆëŠ” userIdListë¡œ user ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ”, chattingsì™€ friends ëª¨ë‘ë¥¼ êµ¬ë…í•˜ê³  ìˆì–´ì•¼ í–ˆë‹¤. user ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ì´ê¸° ë•Œë¬¸ì— `useUsers`ë¼ëŠ” í›…ì— ë§Œë“¤ê³  ë°˜í™˜í–ˆì—ˆë‹¤. ë¬¸ì œëŠ” ë‹¨ìˆœíˆ users ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œ `useUsers` í›…ì„ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒê²¼ë‹¤. í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” chattings ìƒíƒœì— ê´€ì‹¬ì´ ì—†ì§€ë§Œ, useUsers í›…ì—ì„œ chattingsë¥¼ êµ¬ë…í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ê·¸ ìƒíƒœê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ ì“¸ë°ì—†ëŠ” ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ë¦¬ì½”ì¼ì˜ `selectorFamily`ë¥¼ ë” ì ê·¹ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆë‹¤. ê°ê°ì˜ ë¡œì§ì„ `selector` ë‚´ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ë©´ì„œ ë¶ˆí•„ìš”í•œ ë Œë”ë§ì„ ë§‰ì„ ìˆ˜ ìˆì—ˆë‹¤.

## 4\. Function as Child Component

ì±„íŒ…ëª©ë¡ê³¼ ì¹œêµ¬ëª©ë¡ì˜ itemì„ ê°™ì€ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¬ì‚¬ìš©í•˜ë ¤ê³  í–ˆë‹¤. ì €ë²ˆ ê³¼ì œì—ëŠ” ListItem ì»´í¬ë„ŒíŠ¸ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ëŠ” RoomListItem, FriendsListItem ë‘ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í–ˆë‹¤. ìƒìœ„ ì»´í¬ë„ŒíŠ¸ë¥¼ í•˜ë‚˜ ë‘ê³  ìƒíƒœë¥¼ ê°€ê³µí•´ì„œ propsìœ¼ë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ì—ˆë‹¤ (ë™ì¼í•œ ListItemProps íƒ€ì…ì˜ propsë¥¼ ë„˜ê²¨ì£¼ì–´ì•¼ í–ˆëŠ”ë°, ê° í˜ì´ì§€ì—ì„œ ê°–ê³  ìˆëŠ” ìƒíƒœëŠ” usersì™€ chattingsë¡œ ë‹¤ë¥´ë‹¤). ë˜ë ¤ ë¶ˆí•„ìš”í•˜ê²Œ ì½”ë“œê°€ ë¶„ë¦¬ë˜ì–´ì„œ ì˜¤íˆë ¤ ë¶ˆí¸í•´ì§€ëŠ” ê°ì´ ìˆì—ˆë‹¤.

![](https://blog.kakaocdn.net/dn/JyU1Q/btrQr6u1kze/HLVkPsUFHPfRpy0R4CkvzK/img.gif)
_ê¸°ì¡´ ê³¼ì œ ì½”ë“œ. ë²ˆê±°ë¡­ê²Œ ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ íƒ€ê³  íƒ€ê³  ë„˜ì–´ê°€ì•¼ í•˜ëŠ” ëŠë‚Œ_

ì´ë²ˆ ê³¼ì œì—ì„œëŠ” ê°™ì€ íŒŒì¼ ë‚´ì—ì„œ ì‘ì„±í•˜ë˜ ListItem ì»´í¬ë„ŒíŠ¸ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ë¯¼í•´ë³´ì•˜ë‹¤. Function as Child Component ë¼ëŠ” íŒ¨í„´ì„ ì ìš©í–ˆë‹¤. Headless ì»´í¬ë„ŒíŠ¸ì˜ ì¼ì¢…ìœ¼ë¡œ, ìƒíƒœëŠ” ì œì–´í•˜ì§€ë§Œ ìŠ¤íƒ€ì¼ë§ì€ ë‹´ë‹¹í•˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë§í•œë‹¤.

```tsx filename="Friends.tsx"
const Friends = () => {
  const friends = useRecoilValue(friendsState);
  const me = useRecoilValue(userState);

  return (
    <Wrapper>
      {/* ...ìƒëµ */}
      <MyProfile>
        <Squircle imageUrl={me.profileImage} selected={false} size={55} />
        <div>{me.userName}</div>
      </MyProfile>
      <Divider />
      <SubHeading>ì¹œêµ¬ {friends.length}</SubHeading>
      {friends.map((friend) => (
        <FriendListHeadless friend={friend} key={friend.userId}>
          {({ friend, handleClickListItem }) => (
            <ListItem data={friend} handleClickListItem={handleClickListItem} />
          )}
        </FriendListHeadless>
      ))}
    </Wrapper>
  );
};

export default Friends;
```

friends ë°°ì—´ì„ `map`ìœ¼ë¡œ ëŒë ¤ í•˜ë‚˜ì”© ì•„ì´í…œì„ ë Œë”ë§í•œë‹¤. íŠ¹ì´í•œê±´ ë°˜í™˜í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ëª¨ì–‘ì´ë‹¤.

`<FriendListHeadless />` ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ childì—ëŠ” ë˜ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸(ListItem)ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ê°€ ë“¤ì–´ê°„ë‹¤. ê·¸ í•¨ìˆ˜ëŠ” friend ê°ì²´ì™€ í´ë¦­ì´ë²¤íŠ¸ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ì•„ ListItemì˜ propsìœ¼ë¡œ ì§‘ì–´ë„£ëŠ” í˜•íƒœì´ë‹¤.

```tsx filename="FriendListHeadless.tsx"
interface FriendListHeadlessProps {
  friend: IUser;
  children: (args: any) => JSX.Element;
}

const FriendListHeadless = ({ friend, children }: FriendListHeadlessProps) => {
  const navigate = useNavigate();
  const chattingId = useRecoilValue(
    chattingStateByUserId(friend.userId)
  ).chattingId;

  return children({
    friend: friend,
    handleClickListItem: () => navigate(`/room/${chattingId}`),
  });
};
```

Headless ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ chattingId ìƒíƒœë¥¼ ë°›ì•„ì˜¨ë‹¤. í•´ë‹¹ ì±„íŒ…ë°©ìœ¼ë¡œ `navigate` í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í–ˆë‹¤. ê·¸ë¦¬ê³  children ì»´í¬ë„ŒíŠ¸ì˜ propsìœ¼ë¡œ ë„˜ê²¨ì¤€ë‹¤. êµ³ì´ í•œ ì»´í¬ë„ŒíŠ¸ê°€ ë” í•„ìš”í•œ ì´ìœ ëŠ” chattingsê°€ ì•„ë‹Œ ê° chattingì˜ ìƒíƒœê°€ í•„ìš”í–ˆê¸° ë•Œë¬¸. `map`ìœ¼ë¡œ ëŒë¦¬ê³  ìˆëŠ” ê·¸ ì•ˆì—ì„œ ì´ë£¨ì–´ì ¸ì•¼í–ˆë‹¤. ë²ˆê±°ë¡œì´ ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ íƒ€ê³ íƒ€ê³  ë‚´ë ¤ê°ˆ í•„ìš” ì—†ì´, Headlessì»´í¬ë„ŒíŠ¸ê°€ ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ë¥¼ childë¡œ ë‘ê³ ìˆëŠ”ì§€ë„ í•œëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ê²ƒë„ ì¥ì ì¸ ê²ƒ ê°™ë‹¤.

<Img
  src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F55GvV%2FbtrQpSFgEy7%2FxAU1qOnaFR9Z4hEIXLm79k%2Fimg.png"
  width={300}
/>
*ì¹œêµ¬ ëª©ë¡*

<Img
  src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbjAFxt%2FbtrQqk9aRMk%2FHzMn5UFoRt3cjneYkZk510%2Fimg.png"
  width={300}
/>
*ì±„íŒ… ëª©ë¡*

#### 4.1 íƒ€ì… ê°€ë“œ

ë˜ë‹¤ì‹œ ë§ˆì£¼ì¹œ ê³ ë¯¼ í¬ì¸íŠ¸. ë˜‘ê°™ì€ ListItem ì»´í¬ë„ŒíŠ¸ì˜ data propsë¡œ ë‚´ë ¤ì˜¤ëŠ” ê°ì²´ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤. ì±„íŒ…ëª©ë¡ì—ì„œëŠ” `IChatting` íƒ€ì…, ì¹œêµ¬ëª©ë¡ì—ì„œëŠ” `IUser` íƒ€ì…ì˜ ê°ì²´ì´ë‹¤. í”„ë¡œí•„ì´ë¯¸ì§€ì™€ ì‚¬ìš©ì ì´ë¦„ì€ ê³µí†µìœ¼ë¡œ ì“°ì§€ë§Œ `IChatting` íƒ€ì…ì˜ ê°ì²´ì—ëŠ” userId ë°–ì— ì—†ê¸° ë•Œë¬¸ì— ë”°ë¡œ friends ìƒíƒœì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë“±ì˜ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ì±„íŒ…ëª©ë¡ì—ì„œëŠ” ìƒíƒœë©”ì‹œì§€ ëŒ€ì‹  ë§ˆì§€ë§‰ ì±„íŒ…ê³¼ ê·¸ ë‚ ì§œê°€ ë³´ì—¬ì ¸ì•¼ í•œë‹¤.

```ts
const isChattingType = (data: any): data is IChatting => {
  return data.chattingId !== undefined;
};
```

```tsx
// const isChatting = isChattingType(data);

<InfoSub>
  {isChatting
    ? data.chatList[data.chatList.length - 1].content
    : data.statusMessage}
</InfoSub>
```

íƒ€ì… ê°€ë“œë¥¼ í†µí•´ ì¡°ê±´ë¬¸ì—ì„œ ê°ì²´ì˜ íƒ€ì…ì„ ì¢í˜€ ë‚˜ê°ˆ ìˆ˜ ìˆë‹¤. ë‹¨ìˆœíˆ ì–´ë–¤ ì¸ìëª…ì€ ì–´ë– í•œ íƒ€ì…ì´ë‹¤ë¼ëŠ” ê°’ \(is í‚¤ì›Œë“œ)ì„ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ íƒ€ì…ê°€ë“œ í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

> ê·¼ë° ì´ë ‡ê²Œ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì„ í•˜ë‚˜ë¡œ ë§Œë“œëŠ”ê²Œ ì¢‹ì€ ì½”ë“œì¼ê¹Œ..?
>
> ì±„íŒ…ëª©ë¡ê³¼ ìœ ì €ëª©ë¡ ëª¨ë‘ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë””ìì¸ë˜ì–´ìˆê¸´ í•˜ì§€ë§Œ, ì—¬ì „íˆ ë³€ê²½ì´ ìƒê¸°ë©´ ì»´í¬ë„ŒíŠ¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤. ì• ì´ˆì— ì»´í¬ë„ŒíŠ¸ë¥¼ ë„ë©”ì¸ê³¼ ì™„ì „íˆ ë¶„ë¦¬í•´ì„œ \{ profileImage, mainText, subText, time? } ë“±ì˜ ë²”ìš©ì ì¸ propsë¥¼ ë°›ë„ë¡ í•˜ë©´ ë” ì¢‹ì€ ì»´í¬ë„ŒíŠ¸ê°€ ë˜ë ¤ë‚˜..?
>
> [ë³€ê²½ì— ìœ ì—°í•œ ì»´í¬ë„ŒíŠ¸](https://jbee.io/web/components-should-be-flexible/)

## 5\. ë‡Œ ë¹¼ê³  ì§°ë˜ JSX, Styled-components

<Img
  src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FxaqHa%2FbtrQpV2662m%2Fjo9lkEQgmPsBFOsloCfc41%2Fimg.png"
  width={400}
/>
_ìƒˆê±° / ì˜›ë‚ ê±°_

JSXë¶€í„° Styled components í•¨ìˆ˜ê¹Œì§€ ë­í•˜ë‚˜ ì œëŒ€ë¡œ ëœê²Œ ì—†ëŠ” ì½”ë“œì˜€ë‹¤. ë‚˜ì™€ ìƒëŒ€ë°©ì˜ ë§í’ì„ ì´ ì„œë¡œ ë°˜ëŒ€ë°©í–¥ì— ìˆì–´ì•¼í–ˆê³ , `(í”„ì‚¬) - ë‚´ìš© - ì‹œê°„` ì˜ ìˆœì„œë„ ë‚˜ì™€ ìƒëŒ€ë°©ì´ ë°˜ëŒ€ë¡œ ë˜ì–´ìˆë‹¤. ê·¸ë¦¬ê³  í•œëª…ì´ ì—°ì†í•´ì„œ ì±„íŒ…ì„ ë³´ë‚¼ë•Œ, ì²«ë²ˆì§¸ë¡œ ë³´ë‚¸ ë§í’ì„ ì—ë§Œ ê¼¬ë¦¬ê°€ ë‹¬ë ¤ ìˆì–´ì•¼ í–ˆë‹¤. ê·¸ ê¼¬ë¦¬ì˜ ìŠ¤íƒ€ì¼ë„ ë‚˜ì™€ ìƒëŒ€ë°©ì´ ë‹¤ë¥´ë‹¤.

ê³„ì†í•´ì„œ ë³µì¡í•œ ì¡°ê±´ì„ í•˜ë‚˜ì”© ì¶”ê°€í•´ê°€ë©° ê°œë°œí–ˆë‹¤ë³´ë‹ˆ ì ì  ë”ëŸ¬ìš´ ì½”ë“œê°€ ë˜ì–´ê°”ë‹¤. ì´ë²ˆ ê³¼ì œì—ì„œëŠ” ì²˜ìŒë¶€í„° ì—´ì‹¬íˆ ê³ ë¯¼í•˜ê³  êµ¬ì„±ì„ í•´ë³´ì•˜ë‹¤.

1\. `flex-end`ì™€ `flex-start`ë¥¼ ì´ìš©í•´ ìš°ì¸¡ì •ë ¬ ì¢Œì¸¡ì •ë ¬ì„ ê°„ë‹¨íˆ í•  ìˆ˜ ìˆë‹¤.

2\. ìš”ì†Œì˜ ìˆœì„œëŠ” flexboxì—ì„œ `order` ì†ì„±ì„ ì´ìš©í•´ css ë‚´ì—ì„œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

3\. ë§í’ì„  ê¼¬ë¦¬ê°™ì€ ë³µì¡í•œ ìŠ¤íƒ€ì¼ì€ ë”°ë¡œ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•´ ë„£ì–´ì¤€ë‹¤.

ì´ë ‡ê²Œ 36ì¤„ì´ì—ˆë˜ JSX ì½”ë“œë¥¼ 12ì¤„ë¡œ ì¤„ì¼ ìˆ˜ ìˆì—ˆë‹¤. Styled component ë¶€ë¶„ì€ ë”ìš± ì¤„ì–´ë“¤ì—ˆë‹¤. ê±°ì˜ ë‘ë°° ê°€ê¹Œì´ ê°„ê²°í•´ì§„ ì½”ë“œë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.

---

[ì´ë²ˆì— ë¦¬íŒ©í† ë§í•œ ê³¼ì œ ì½”ë“œ](https://github.com/9yujin/react-messenger-16th)ì™€ [ì´ì „ì— í–ˆë˜ ê³¼ì œ ì½”ë“œ](https://github.com/9yujin/react-messenger-15th).

ë˜‘ê°™ì€ ê¸°ëŠ¥ì´ë”ë¼ë„ ê³„ì† ê³ ë¯¼í•´ê°€ë©° ë¦¬íŒ©í† ë§í•˜ëŠ” ê²½í—˜ì´ ì¤‘ìš”í•˜ë‹¤.  
ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒì„ ì–»ì–´ê°€ëŠ” ê³¼ì œì˜€ë‹¤.
